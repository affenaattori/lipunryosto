<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lipunryöstö – Admin</title>
  <style>
    :root{--bg:#0f172a;--card:#111827;--line:#1f2937;--muted:#9ca3af;--accent:#60a5fa}
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:#e5e7eb;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .bar{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid var(--line);background:#0b1220;position:sticky;top:0;z-index:10}
    .title{display:flex;align-items:center;gap:10px}
    .pill{padding:4px 10px;border-radius:999px;background:#1f2937;color:var(--muted);font-size:12px}
    .iconbtn{border:1px solid #374151;background:#0b1220;color:#e5e7eb;border-radius:10px;padding:8px 10px;cursor:pointer}
    .wrap{max-width:1100px;margin:0 auto;padding:14px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:12px}
    h3{margin:.4rem 0 0.6rem}
    .small{font-size:12px;color:var(--muted)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    input,select,button{border-radius:10px;border:1px solid #374151;background:#0b1220;color:#e5e7eb;padding:8px 10px}
    button{border:0;background:var(--accent);color:#0b1220;font-weight:700;cursor:pointer}
    .btn-ghost{background:#1f2937;color:#e5e7eb;border:1px solid #374151}
    .btn-warn{background:#f59e0b;color:#1f1300}
    .btn-danger{background:#ef4444;color:#16070a}
    .list{display:flex;flex-direction:column;gap:8px}
    .chip{width:22px;height:22px;border-radius:6px;border:1px solid #111;cursor:pointer}
    .chip.sel{outline:2px solid #e5e7eb}
    .team{display:flex;align-items:center;gap:8px;padding:8px;border:1px solid #1f2937;border-radius:10px}
    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center}
    .modal>.box{background:#0b1220;border:1px solid #374151;border-radius:12px;padding:16px;min-width:320px}
    /* Color input */
    input[type="color"]{padding:0;width:48px;height:36px;border-radius:8px;border:1px solid #374151;background:#0b1220}
  </style>
</head>
<body>
  <div class="bar">
    <div class="title">
      <span class="pill">Admin</span>
      <span id="gameBadge" class="pill">Peli: –</span>
    </div>
    <div class="row">
      <button id="openSettings" class="iconbtn">⚙️ Asetukset</button>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <!-- Pelin asetukset & ohjaus -->
      <div class="card">
        <h3>Pelin asetukset</h3>
        <div class="small">Luo uusi peli tai valitse olemassa oleva. Voit muokata asetukset ennen luontia.</div>
        <div class="row" style="margin-top:8px">
          <input id="gName" placeholder="Pelin nimi" style="flex:2;min-width:220px">
          <input id="gCapture" type="number" min="5" step="5" value="60" style="width:120px" title="Valtausaika (s)">
          <select id="gWin" style="min-width:220px">
            <option value="MostPointsAtTime">Voitto: eniten pisteitä ajan päättyessä</option>
            <option value="AllFlagsOwned">Voitto: kaikki liput samalla joukkueella</option>
          </select>
        </div>
        <div class="row">
          <label class="row" style="align-items:center">
            <input id="gUseTime" type="checkbox">
            <span class="small">Aikaraja (min)</span>
            <input id="gTime" type="number" min="1" step="1" value="30" style="width:100px">
          </label>
          <label class="row" style="align-items:center">
            <input id="gUseMax" type="checkbox">
            <span class="small">Maksimi pisteet</span>
            <input id="gMax" type="number" min="1" step="1" value="100" style="width:100px">
          </label>
        </div>
        <div class="row" style="margin-top:8px">
          <button id="createGame">Luo peli</button>
          <select id="gameSelect" style="min-width:280px"></select>
          <button id="refreshGames" class="btn-ghost">Päivitä pelit</button>
        </div>
        <hr style="border-color:#1f2937;margin:14px 0">
        <h3>Pelin ohjaus</h3>
        <div class="row">
          <button id="startGame">Käynnistä</button>
          <button id="pauseGame" class="btn-warn">Tauko</button>
          <button id="endGame" class="btn-danger">Lopeta</button>
        </div>
      </div>

      <!-- Joukkueet -->
      <div class="card">
        <h3>Joukkueet</h3>
        <div class="small">Valitse väri paletista ja anna nimi.</div>
        <div class="row" id="palette" style="margin:8px 0;flex-wrap:wrap"></div>
        <div class="row">
          <input id="teamName" placeholder="Joukkueen nimi" style="flex:2;min-width:220px">
          <button id="addTeam">Lisää joukkue</button>
        </div>
        <div id="teamList" class="list" style="margin-top:10px"></div>
      </div>

      <!-- Lippupisteet & pelialue (kartta) -->
      <div class="card" style="grid-column:1 / span 2">
        <h3>Lippupisteet & pelialue</h3>
        <div id="adminMap" style="height:420px;border-radius:12px;overflow:hidden;border:1px solid #1f2937"></div>
        <div class="row" style="margin-top:8px;gap:8px;flex-wrap:wrap;align-items:center">
          <button id="btnStartDraw">Piirrä alue</button>
          <button id="btnUndo" class="btn-ghost">Peru piste</button>
          <button id="btnClear" class="btn-danger">Tyhjennä</button>
          <button id="btnSaveArea" class="btn-ghost">Tallenna alue</button>
          <span class="small">Alueen väri</span>
          <input id="areaColor" type="color" value="#f59e0b" title="Alueen väri">
          <button id="openPublic" class="btn-ghost" onclick="window.open(`${location.origin}/public/?api=${encodeURIComponent(localStorage.getItem('admin_apiBase')||'')}`,'_blank')">Avaa Public</button>
        </div>
        <div class="small">Klikkaa karttaa lisätäksesi pisteen (piirtotilassa). Vähintään 3 pistettä muodostaa alueen. “Tallenna alue” tallentaa <code>/games/{id}/area</code>, jossa <code>properties.color</code> sisältää valitun värin.</div>
      </div>

      <!-- Kenttälinkit (A–J) -->
      <div class="card" style="grid-column:1 / span 2">
        <h3>Kenttälinkit (A–J)</h3>
        <div class="small" style="margin-bottom:6px">
          Linkit lippupisteiden aktivointiin laitteissa. (Avaa / Kopioi)
        </div>
        <div id="fieldLinks" class="list" style="margin-bottom:10px"></div>
        <div class="row">
          <button id="copyAllLinks" class="btn-ghost">Kopioi kaikki</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Asetukset-modal (API base) -->
  <div id="modal" class="modal">
    <div class="box">
      <h3>Asetukset</h3>
      <div class="small">Anna API-osoite (App Service), esim. https://…azurewebsites.net</div>
      <input id="apiBase" placeholder="https://<api>.azurewebsites.net" style="width:100%;margin-top:8px">
      <div class="row" style="margin-top:10px;justify-content:flex-end">
        <button id="closeSettings" class="btn-ghost">Peruuta</button>
        <button id="saveApi">Tallenna</button>
      </div>
    </div>
  </div>

  <script src="./admin.js"></script>
</body>
</html>
